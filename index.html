<!doctype html><html lang="fr"><head><title>Lost Lost Soul</title><style>*{margin:0;padding:0}*,::after,::before{box-sizing:border-box}body{background:#333;font-size:0}#game{position:absolute;top:calc(50% - 200px);left:calc(50% - 450px);width:900px;height:400px;background:#356a9e;border:1px solid #000}#bg1,#bg2,#canvas,#shop,#start,#ui{position:absolute;top:0;left:0;width:100%;height:100%}#bg1{animation:bg1 20s linear infinite;transform:translateZ(0)}@keyframes bg1{from{background-position:0 0}to{background-position:-1360px 0}}#bg2{animation:bg2 15s linear infinite;transform:translateZ(0)}@keyframes bg2{from{background-position:0 0}to{background-position:-1500px 0}}#shop,#start{color:#fff;font-family:sans-serif;text-align:center;padding-top:40px;font-size:20px;font-variant:small-caps}#start{padding-left:40%}#shop{display:none}.title{margin:0 0 40px;font-size:40px}#controls{margin:0 0 20px}#rules{margin:0 0 60px}#start-button{display:inline-block;border:3px solid #000;background:rgba(255,255,255,.7);font-size:30px;line-height:70px;height:70px;padding:0 30px;color:#000;cursor:pointer;text-transform:uppercase}#ui{display:none;pointer-events:none}#diamonds,#health{position:absolute;width:40px;line-height:30px;font-size:20px;color:#fff}#diamonds{right:0}#health{left:10px}.diamond{padding-left:20px;background-repeat:no-repeat;background-position:left center}#shop-item-list{text-align:left}#shop-item-list li{display:inline-block;vertical-align:top;width:50%;padding-left:10px}.shop-item-data{width:90px;display:inline-block;vertical-align:middle}.shop-text{width:calc(100% - 90px);display:inline-block;vertical-align:top}</style></head><body><div id="game" class="el"><div id="bg1"></div><div id="bg2"></div><canvas id="canvas"></canvas><div id="start"><h1 class="title">Lost soul</h1><p id="controls">Space / Touch screen : Jump</p><p id="rules">Survive as long as you can in this infinite cave<br>Collect diamonds to buy improvements between each play</p><p id="start-button">Start</p></div><div id="shop"><h1 class="title">Shop</h1><ul id="shop-item-list"><li><p class="shop-item-data">+10% <span class="diamond shop-item-price">50</span></p><div class="shop-text"><h2>Light power</h2>Increases light duration current bonus: <span>0%</span></div></li></ul></div><div id="ui"><p id="health">100</p><p id="diamonds" class="diamond">0</p></div></div><script>!function(){"use strict";function t(){return(Math.random()+Math.random()+Math.random()+Math.random()+Math.random()+Math.random()-3)/3}function e(){var t=900/window.innerWidth,e=420/window.innerHeight,n=Math.min(1.2,1/Math.max(t,e));Q.style.webkitTransform=Q.style.transform="scale("+n+")"}function n(t,e,n,o,l,a,r,d){t.width=(e+2*l)*a;let c=document.createElement("canvas");c.width=t.width,c.height=n;let h=c.getContext("2d");h.fillStyle=r,h.fillRect(0,0,c.width,c.height);for(let t=0;t<a;++t)i(h,l+t*(e+2*l),c.height/2,e,c.height*o,d);t.style.backgroundImage="url("+c.toDataURL()+")"}function i(e,n,i,o,l,a){e.globalCompositeOperation="destination-out",e.beginPath();let r=n,d=0,c=i,h=a?40:25,f=.2*(t()+1)*l-.1*l,u=.25;for(let n=-1;n<=1;n+=2){let s=0;d=0,c=i;let g=1;for(e.moveTo(r,i+f);d<o-o/h&&!((d+=(t()+1)*o/h)>=o);){let f=d;if(a){u=.15;let t=s/h;t<.33?(f=.8*d+.05*o,u=.7):t>.67?(f=.8*d+.2*o,u=.7):f=d}1===g&&c<i+l?(c+=l/(.5+1.5*(t()+1))*n)>=i+l*n&&(c=i+l*n,g=2):c=i+(t()+1)*l*u*n+(1-u)*l*n,e.lineTo(Math.floor(r+f),Math.floor(c)),++s}e.lineTo(r+o,i+f),e.lineTo(r,i+f),e.fillStyle="white",e.fill()}}function o(){F.style["animation-duration"]=Math.floor(1e3*(Z-$/1e4))/1e3+"s",N.style["animation-duration"]=Math.floor(1e3*(K-$/1e4))/1e3+"s"}function l(){let t=document.createElement("canvas");t.width=q.width,t.height=q.height;let e=t.getContext("2d"),n=Math.max(60,I-$/1e3*S)-Math.abs($/200%10-5),i=Math.max(5,B-$/1e3*(S*B/I));e.fillStyle="rgba(0, 0, 0, "+(1-i/100)+")",e.fillRect(0,0,q.width,q.height);let o=G.x+G.width/2,l=e.createRadialGradient(o,G.y,0,o,G.y,Math.floor(1e3*n)/1e3);l.addColorStop(0,"rgba(0,0,0,1)"),l.addColorStop(.8,"rgba(0,0,0,.9)"),l.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=l,e.globalCompositeOperation="destination-out",e.fillRect(o-n,G.y-n,2*n,2*n),z.drawImage(t,0,0)}function a(){R.width=C,R.height=D;var t=R.getContext("2d");t.fillStyle="#ebf855",t.beginPath(),t.moveTo(0,D/2),t.lineTo(C/2,0),t.lineTo(C,D/2),t.lineTo(C/2,D),t.fill(),t.fillStyle="#eee21c",t.beginPath(),t.moveTo(2,10),t.lineTo(5,0),t.lineTo(8,10),t.lineTo(5,20),t.fill(),[].forEach.call(document.querySelectorAll(".diamond"),function(t){t.style["background-image"]='url("'+R.toDataURL()})}function r(t,e){z.drawImage(R,t-C/2,e-D/2)}function d(){for(let t=0;t<V;++t){let e=c(0===t);e.x=0===t?0:lt[t-1].x+lt[t-1].w,console.log(e),lt.push(e)}}function c(t){let e;e=t?L:k[Math.floor(Math.random()*Y)];var n=0;for(let t of e.p){var[i,o,l]=t;n=Math.max(n,l)}let a=document.createElement("canvas");a.width=(n+.5)*X*P,a.height=q.height;let r=a.getContext("2d");var d=[];for(let t of e.p){var[i,o,l]=t;let e=[.5+i*X*P,q.height-30-100*o,Math.ceil(l*X*P)];f(r,e),d.push(e)}return{w:a.width,c:a,p:d,d:e.d.slice(0),s:e.s.slice(0),speed:X*P}}function h(){for(let f=0;f<V;++f){let u=lt[f],s=Math.floor(u.x-$*X/1e3);z.drawImage(u.c,s,0);for(let t of u.d){let e=s+Math.floor(t[0]*u.speed),n=q.height-30-100*t[1];e>0&&e<q.width&&r(e,n)}if(s+u.w<0){var t=lt[(f-1+V)%V],e=c();e.x=t.x+t.w,lt[f]=e}if(G.x>=s&&G.x<s+u.w){for(let t in u.d){var n=u.d[t];let e=s+Math.floor(n[0]*u.speed),i=q.height-30-100*n[1];Math.sqrt(Math.pow(e-G.x,2)+Math.pow(i-G.y,2))<30&&(lt[f].d.splice(t,1),W.innerText=++tt)}var i=!1;for(let t of u.p){var[o,l,a,d]=t;if(G.x+3>=o+s&&G.x-3<=a+s){var h=G.y+G.height/2;if(h>=l&&h<l+11){i=!0,G.y=l-G.height/2;break}}}i?G.currentVelocityY>0&&w():y()}}}function f(e,n){var[i,o,l]=n;let a=Math.min((l-i)/10,25+5*t()),r=[],d=i;for(;d<l-a&&!((d+=(t()+1)*a)>=l);)r.push([d,o+10+30*(t()+1)*2/3]);e.beginPath(),e.moveTo(i,o+2);for(let t in r)e.lineTo(r[t][0],r[t][1]+2);e.lineTo(l,o+2),e.fillStyle="#376d91",e.fill(),e.beginPath(),e.moveTo(i,o);for(let t in r)e.lineTo(r[t][0],r[t][1]);for(e.lineTo(l,o),e.fillStyle="#122937",e.fill(),e.beginPath(),e.moveTo(i,o),a=Math.min((l-i)/50,5+5*t()),d=i;d<l-a&&!((d+=(t()+1)*a)>=l);)e.lineTo(d,o+2+3*(t()+1));e.lineTo(l,o),e.fillStyle="#376d91",e.fill()}function u(){G={x:200,y:182,width:42,height:36,isJumping:!1,isOnGround:!0,currentVelocityY:0};let t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAkAgMAAACCp0C4AAAADFBMVEUAAAD///////8AAAA4fh26AAAAAnRSTlMA32D/An0AAACJSURBVBjTrdC9DYQwDIbhyHRMckp1y+SKq648MUWWQELQICH+vASMxAYQ7BAHQclbPZL1NVZ7iGgVB85/79Q580bXWIuRDeSBrMmdFePFJB6Dd/GEpztzpRXj7+xU/IqMOvLRVAe38xzcRe7XJbhS7+BGPO6GL08TZ38YyDoy5MaYj2Lzl5N12QDN7Ll+6NbFBQAAAABJRU5ErkJggg==",t.addEventListener("load",function(){U=!0}),G.image=t}function s(){z.drawImage(G.image,G.x-G.width/2,G.y-G.height/2);let t=Math.floor($/100)%50!=4?5:1;z.fillStyle="#000",z.fillRect(G.x-2,G.y-3,3,-t),z.fillRect(G.x+9,G.y-3,3,-t);let e=Math.max(25,100-$/1e3*(100*S/I));z.fillStyle="rgba(255, 255, 168, "+e/100+")",z.fillRect(G.x+15,G.y+10,5,7)}function g(){G.isOnGround&&(console.log("start:",$),G.currentVelocityY=-J,G.isOnGround=!1,G.isJumping=!0)}function m(){G.currentVelocityY<-4&&(G.currentVelocityY=-4)}function y(){G.isOnGround&&(G.currentVelocityY=.5,G.isOnGround=!1)}function w(){console.log("stop:",$),G.currentVelocityY=0,G.isOnGround=!0}function A(t){et=Math.max(0,et-t),j.innerText=et,et<=0&&M()}function p(){G.isOnGround||(G.currentVelocityY=Math.min(G.currentVelocityY+O,11),G.y+=G.currentVelocityY),G.y-G.height/2>q.height&&(A(it),G.y=-G.height/2)}function v(){_=+new Date,$=0,d(),ot.style.display="none",H.style.display="block",b()}function M(){nt=!0}function x(){let t=new Date;$=t-_,z.clearRect(0,0,q.width,q.height),s(),l()}function b(){if(at)return;let t=new Date;if($=t-_,rt>0){let e=t-rt;_+=e,$-=e,rt=0}o(),z.clearRect(0,0,q.width,q.height),p(),h(),s(),l(),nt||requestAnimationFrame(b)}function T(){at=!0,F.style["animation-play-state"]="paused",N.style["animation-play-state"]="paused",rt=+new Date}function E(){at=!1,F.style["animation-play-state"]="running",N.style["animation-play-state"]="running",b()}var S=4;const I=200,B=70;var R=document.createElement("canvas"),C=10,D=20;const V=3;var L={p:[[0,0,10]],d:[[4.9,.5],[5.3,.8],[5.7,.5],[6.9,.7],[7.3,1.2],[7.9,1.2],[8.3,.7]],s:[]},k=[{p:[[0,0,2],[2.5,1,3.5],[4,2,5],[4,0,7]],d:[[4.2,2.2],[4.5,2.2],[4.8,2.2]],s:[[4,0,5]]}],Y=k.length,G={};const O=.2,J=7.4,P=.7;var U=!1;window.addEventListener("keydown",function(t){switch(t.keyCode){case 32:case 38:G.isJumping||g();break;case 27:at?E():T()}}),window.addEventListener("keyup",function(t){switch(t.keyCode){case 32:case 38:G.isJumping=!1,m()}}),window.addEventListener("touchstart",function(t){G.isJumping||g()}),window.addEventListener("touchend",function(t){G.isJumping=!1,m()}),window.addEventListener("resize",function(t){e()}),document.getElementById("start-button").addEventListener("click",function(){v()});var Q=document.getElementById("game"),q=document.getElementById("canvas");q.width=900,q.height=400;var z=q.getContext("2d"),F=document.getElementById("bg1"),N=document.getElementById("bg2"),H=document.getElementById("ui"),W=document.getElementById("diamonds"),j=document.getElementById("health"),X=200,Z=20,K=15,$=0,_=+new Date,tt=0,et=100,nt=!1;const it=20;var ot=document.getElementById("start"),lt=[],at=!1,rt=0;!function(){e(),u(),a(),_=+new Date-1e5;var t=setInterval(function(){U&&(clearInterval(t),n(F,300,q.height,.2,20,4,"#1e3d5a",!1),n(N,400,q.height,.3,50,3,"#101f32",!0),s(),l(),x())},10)}()}();</script></body></html>